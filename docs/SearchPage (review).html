<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="SearchPage (review).css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.83/dist/themes/light.css" />
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.83/dist/shoelace.js"></script>
  </head>
  <body>
    <div class="SearchPage_review">
      <div class="entire-area">

        <div class="header">
          <div class="div1">
            <a class="web-name" href="MainPage (user).html">Snowmap</a>
          </div>
          <div class="bottom-app-bar">
            <img id="search-img" src="image/search.png" />
            <input type="text" placeholder="Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" id="search-form"></input>
             <button type="button" class="btn btn-dark" id="search-btn" >Í≤ÄÏÉâ</button>
          </div>
          <div class="button-group" id="buttonGroup"></div>

          <!-- ‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ† Ï∂îÍ∞Ä ‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ† -->
          <div class="mobile-button-group">
            <!-- ÌñÑÎ≤ÑÍ±∞ Î≤ÑÌäº -->
            <button class="mobile-button btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu" aria-controls="mobileMenu">
              <div class="navbar-toggler-icon"></div>
            </button>

            <!-- Offcanvas Î©îÎâ¥ -->
            <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileMenu" aria-labelledby="mobileMenuLabel">
              <div class="offcanvas-close-area">
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
              </div>
              <div class="offcanvas-header">
                <div class="offcanvas-title" id="mobileMenuLabel">
                  <a class="account-inf-mobile" href="MyPage (check).html">
                    <img src="image/avatar.png" alt="Îì±Í∏â" id="grade-img-mobile"/>
                    <div class="account-detail-nickname">ÎãâÎÑ§ÏûÑ&nbsp;</div>
                    <div>&nbsp;&gt;</div>
                  </a>
                </div>
              </div>
              
              <div class="offcanvas-body">
                <ul class="list-unstyled">
                  <hr/>
                  <li><a href="Ïª§ÎÆ§ÎãàÌã∞.html">Ïª§ÎÆ§ÎãàÌã∞</a></li>
                  <hr/>
                  <li><a href="Îû≠ÌÇπ.html">Îû≠ÌÇπ</a></li>
                  <hr/>
                  <li><a href="MyPage (check)?tab=wishlist">Ï∞úÌïú Í∞ÄÍ≤å</a></li>
                  <hr/>
                </ul>
              </div>
              <div style="text-align: right;">
                <button id="logout-button" class="button" onclick="logout()">
                  <img class="logout-img" src="image/logout.png">
                  <span class="logout-text">Î°úÍ∑∏ÏïÑÏõÉ</span>
                </button>
              </div>
            </div>
          </div>
          <!-- ‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ† Ï∂îÍ∞Ä ÏôÑÎ£å ‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ† -->
        </div>
  
        <div class="aside"></div>

       
        <!--Ïó¨Í∏∞Î∂ÄÌÑ∞ Î≥µÎ∂ôÏãúÏûë-->
        <div class="aside2">
          <div class="simple-ranking">
            <ul class="nav nav-pills">
              <li class="nav-item">
                <a class="nav-link active"  data-bs-toggle="pill" aria-current="page" href="#" onclick="handleSortAside('rating')">
                  Î≥ÑÏ†êÏàú</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#" onclick="handleSortAside('reviews')">Î¶¨Î∑∞Ïàú</a>
              </li>
              <li class="nav-item">
                <a class="nav-link"  data-bs-toggle="pill" href="#" onclick="handleSortAside('bookmark')">Îã®Í≥®Ïàú</a>
              </li>
              
            </ul>
            <ul id="itemList">
            </ul>
            <div id="store-sort"> <!--Ïó¨Í∏∞Ïóê Í∞ÑÎã® Îû≠ÌÇπ Ï†ïÎ†¨Ìï¥ÏÑú ÏÇΩÏûÖ-->
            </div>
          </div>
        </div>
        <!--Ïó¨Í∏∞ÍπåÏßÄ Î≥µÎ∂ôÏôÑÎ£å-->


        <div class="mainbody">
        <!-- Ïó¨Í∏∞ÍπåÏßÄÎäî Í≥†Ï†ï -->

          <!-- ‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ† -->
          <!-- Ïó¨Í∏∞Î∂ÄÌÑ∞ ÏàòÏ†ï ÏãúÏûë -->
          <div class="info-up-area">
            <div class="card">
              <div class="card-image"></div>
              <div class="card-text">
                <div class="text">
                  <div class="text-up-area">
                    <div class="store-name"></div>
                    <div class="rating">
                      <div class="rating2"></div>
                      <div class="element"></div>
                    </div>
                  </div>
                  <div class="p">
                    <div class="store-simple-info"></div>
                    <div class="personal-check search-margin-bottom">
                      <button type="button" class="heart-button" >
                        <!--<img src="image/heart.png" alt="Ï∞úÌïú Í∞ÄÍ≤å" id="personal-heart-img"/>-->
                        <div id="personal-heart-img">ü§ç</div>
                        <span id="personal-heart">Ï∞úÌïú Í∞ÄÍ≤å</span>
                      </button>
                      <button type="button" class="bookmark-button">
                        <img src="image/empty-bookmark.png" alt="Îã®Í≥® Í∞ÄÍ≤å" id="bookmark-img"/>
                        <span id="bookmark">Îã®Í≥® Í∞ÄÍ≤å</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="info-down-area">
            <div class="info-tab-list">
              <div class="tab2">
                <a class="label2" id="go-to-info" href="SearchPage (info).html">Ï†ïÎ≥¥</a>
              </div>
              <div class="tab2">
                <a class="label2" id="go-to-menu" href="SearchPage (menu).html">Î©îÎâ¥</a>
              </div>
              <div class="tab">
                <a class="label" id="go-to-review" href="SearchPage (review).html">Î¶¨Î∑∞</a>
              </div>
            </div>
            <div class="review-main-content">
              <button type="button" id="review-link" class="review-upload-button btn btn-dark">
                <div class="review-upload-button-text" >Î¶¨Î∑∞ ÏóÖÎ°úÎìú</div>
              </button>
              <div class="review-card"></div>
            </div>
          </div>




          
          <script>
            let store_mainbody = [];
          
            window.addEventListener('DOMContentLoaded', () => {
              const urlParams = new URLSearchParams(window.location.search);
              const storeId = urlParams.get('id');
          
              // review-link ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Îì±Î°ù (ÏöîÏÜåÍ∞Ä ÏûàÏúºÎ©¥)
              const reviewLink = document.getElementById('review-link');
              if (reviewLink) {
                reviewLink.addEventListener('click', () => {
                  if (storeId) {
                    window.location.href = `SearchPage (review-upload).html?id=${storeId}`;
                  } else {
                    alert('ÏãùÎãπ IDÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                    window.location.href = `SearchPage.html`;
                  }
                });
              } else {
                console.warn('review-link ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
              }
          
              // Í∞ÄÍ≤å Ï†ïÎ≥¥ JSON Î°úÎìú Î∞è ÌôîÎ©¥ Î†åÎçîÎßÅ
              fetch('stores.json')
                .then(res => res.json())
                .then(data => {
                  store_mainbody = data;
                  const store = store_mainbody.find(s => s.id === storeId);
          
                  if (!store) {
                    alert('Ìï¥Îãπ Í∞ÄÍ≤åÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                  }
          
                  document.querySelector('.card-image').style.backgroundImage = `url(${store.image})`;
          
                  document.querySelector('#go-to-info').href = `SearchPage (info).html?id=${storeId}`;
                  document.querySelector('#go-to-menu').href = `SearchPage (menu).html?id=${storeId}`;
                  document.querySelector('#go-to-review').href = `SearchPage (review).html?id=${storeId}`;
          
                  document.querySelector('.store-name').textContent = store.name;
                  document.querySelector('.element').textContent = store.rating.toFixed(1);
                  document.querySelector('.store-simple-info').textContent =
                    `${store.type} | ÌïôÍµê Í∏∞Ï§Ä ${store.distance}Î∂Ñ | ${store.price.toLocaleString()}Ïõê`;
          
                  renderStars(store.rating);
                })
                .catch(err => console.error('JSON Î°úÎî© Ïã§Ìå®:', err));
          
              // IndexedDBÏóêÏÑú Î¶¨Î∑∞ Î∂àÎü¨ÏôÄ Î†åÎçîÎßÅ
              const container = document.querySelector('.review-main-content');
              const uploadButton = container.querySelector('.review-upload-button');
          
              // Î¶¨Î∑∞ ÏòÅÏó≠ Ï¥àÍ∏∞Ìôî ÌõÑ ÏóÖÎ°úÎìú Î≤ÑÌäº Îã§Ïãú Ï∂îÍ∞Ä
              container.innerHTML = '';
              if (uploadButton) container.appendChild(uploadButton);
          
              const request = indexedDB.open("ReviewDB", 2);
          
              request.onerror = (event) => {
  alert("Î¶¨Î∑∞ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Î°úÎìú Ïã§Ìå®");
  console.error("IndexedDB open error:", event.target.error);
};
          
              request.onsuccess = (event) => {
                const db = event.target.result;
                const tx = db.transaction("reviews", "readonly");
                const store = tx.objectStore("reviews");
                const getAllRequest = store.getAll();
          
                getAllRequest.onsuccess = () => {
                  let reviews = getAllRequest.result;
          
                  if (storeId) {
                    reviews = reviews.filter(review => review.storeId === storeId);
                  }
          
                  if (reviews.length === 0) {
                    const noReviewMsg = document.createElement('div');
                    noReviewMsg.textContent = "ÏûëÏÑ±Îêú Î¶¨Î∑∞Í∞Ä ÏóÜÏäµÎãàÎã§.";
                    noReviewMsg.classList.add('no-review-msg');
                    noReviewMsg.style.textAlign = 'center';
                    noReviewMsg.style.padding = '2rem 0 3rem 0';
                    container.appendChild(noReviewMsg);
                  } else {
                    reviews.forEach(review => {
                      const card = createReviewCard(review);
                      container.appendChild(card);
                    });
                  }
                };
              };
            });
          
            // --- Ïù¥Ìïò Î¶¨Î∑∞ Ïπ¥Îìú ÏÉùÏÑ±, Î™®Îã¨ Îì± Ìï®ÏàòÎäî Í∏∞Ï°¥ Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ ---
          
            function createReviewCard(review) {
              const card = document.createElement('div');
              card.className = 'review-card';
          
              let starsHtml = '';
              const starCount = Math.round(review.rating);
              for (let i = 1; i <= 5; i++) {
                const starSrc = i <= starCount
                  ? "https://c.animaapp.com/kjYfscdy/img/star-60.svg"
                  : "https://c.animaapp.com/kjYfscdy/img/star-59.svg";
                starsHtml += `<img class="small-star" src="${starSrc}" />`;
              }
          
              let imagesHtml = '';
              if (review.images && review.images.length > 0) {
                imagesHtml = review.images
                  .map(src => `<div class="review-image"><img class="review-img" src="${src}" alt="Î¶¨Î∑∞ Ïù¥ÎØ∏ÏßÄ" data-src="${src}" style="cursor:pointer" /></div>`)
                  .join('');
              }
          
              let innerHtml = '';
          
              if (review.title && review.content) {
                innerHtml = `
                  <div class="review-left-up">
                    <div class="small-rating">${starsHtml}</div>
                    <div class="review-text">${review.title}</div>
                  </div>
                  <div class="review-left-down" style="display:flex; align-items:flex-start; gap:0.5rem;">
                    <div id="review-writer" style="width: calc(20vh + 1vw);">${review.nickname}</div>
                    <div class="review-content">${review.content}</div>
                  </div>
                `;
              } else if (review.title && !review.content) {
                innerHtml = `
                  <div class="review-left-up">
                    <div class="small-rating">${starsHtml}</div>
                    <div class="review-text">${review.title}</div>
                  </div>
                  <div class="review-left-down" style="display:flex; align-items:center; gap:0.5rem;">
                    <div id="review-writer" style="width: calc(20vh + 1.4vw);">${review.nickname}</div>
                  </div>
                `;
              } else if (!review.title && review.content) {
                innerHtml = `
                  <div class="review-left-up" style="display:flex; align-items:flex-start; gap:0.5rem;">
                    <div class="small-rating">${starsHtml}</div>
                    <div class="review-content">${review.content}</div>
                  </div>
                  <div class="review-left-down" style="display:flex; align-items:center; gap:0.5rem;">
                    <div id="review-writer" style="width: calc(20vh + 1.4vw);">${review.nickname}</div>
                  </div>
                `;
              } else {
                innerHtml = `
                  <div class="review-left-up" style="display:flex; align-items:center; gap:0.5rem;">
                    <div class="small-rating">${starsHtml}</div>
                  </div>
                  <div class="review-left-down" style="display:flex; align-items:center; gap:0.5rem;">
                    <div id="review-writer" style="width: calc(20vh + 1.4vw);">${review.nickname}</div>
                  </div>
                `;
              }
          
              card.innerHTML = `
                <div class="review-left">
                  ${innerHtml}
                </div>
                <div class="review-right">
                  ${imagesHtml}
                </div>
              `;
          
              const imgs = card.querySelectorAll('.review-img');
              const imageSrcs = review.images || [];
          
              imgs.forEach((img, idx) => {
                img.style.cursor = 'pointer';
                img.addEventListener('click', () => {
                  showModal(imageSrcs[idx], imageSrcs, idx);
                });
              });
          
              return card;
            }
          
            function showModal(imgSrc, allImgs, currentIndex) {
              let existingModal = document.getElementById('image-modal');
              if (existingModal) {
                existingModal.remove();
              }
          
              const modal = document.createElement('div');
              modal.id = 'image-modal';
              Object.assign(modal.style, {
                position: 'fixed',
                top: 0, left: 0,
                width: '100vw', height: '100vh',
                backgroundColor: 'rgba(0,0,0,0.8)',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'center',
                zIndex: 10000,
                cursor: 'zoom-out',
              });
          
              const modalImg = document.createElement('img');
              modalImg.src = imgSrc;
              Object.assign(modalImg.style, {
                maxWidth: '90vw',
                maxHeight: '90vh',
                borderRadius: '8px',
                boxShadow: '0 0 15px rgba(0,0,0,0.5)',
                cursor: 'default',
              });
              modal.appendChild(modalImg);
          
              const leftArrow = document.createElement('div');
              leftArrow.textContent = '‚óÄ';
              Object.assign(leftArrow.style, {
                position: 'absolute',
                left: '2rem',
                top: '50%',
                transform: 'translateY(-50%)',
                fontSize: '3rem',
                color: 'white',
                userSelect: 'none',
                cursor: 'pointer',
                zIndex: 10001,
              });
              modal.appendChild(leftArrow);
          
              const rightArrow = document.createElement('div');
              rightArrow.textContent = '‚ñ∂';
              Object.assign(rightArrow.style, {
                position: 'absolute',
                right: '2rem',
                top: '50%',
                transform: 'translateY(-50%)',
                fontSize: '3rem',
                color: 'white',
                userSelect: 'none',
                cursor: 'pointer',
                zIndex: 10001,
              });
              modal.appendChild(rightArrow);
          
              function updateImage(index) {
                if (index < 0) index = allImgs.length - 1;
                if (index >= allImgs.length) index = 0;
                currentIndex = index;
                modalImg.src = allImgs[currentIndex];
              }
          
              leftArrow.addEventListener('click', (e) => {
                e.stopPropagation();
                updateImage(currentIndex - 1);
              });
          
              rightArrow.addEventListener('click', (e) => {
                e.stopPropagation();
                updateImage(currentIndex + 1);
              });
          
              modal.addEventListener('click', () => {
                modal.remove();
              });
          
              document.body.appendChild(modal);
            }
          </script>
          
               
          
              <script>////////ÌöåÏõê/ÎπÑÌöåÏõê Ï†ÑÌôò///////////////////////
                function logout() {
                 const confirmed = confirm("Ï†ïÎßê Î°úÍ∑∏ÏïÑÏõÉÌïòÏãúÍ≤†ÏäµÎãàÍπå?");
                if (!confirmed) return;
          
                localStorage.removeItem("currentUser");
                updateAsideToGuest();
                renderButtonGroup(); // Î≤ÑÌäº Í∑∏Î£πÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
                window.location.href = "index.html";
          
              }
          
                // ÌöåÏõê UI
                function updateAsideToMember(currentUser) {
                  const aside = document.querySelector(".aside");
                  if (!aside) return;
                  // postCount Í∏∞Ï§ÄÏúºÎ°ú Îì±Í∏â Ïù¥ÎØ∏ÏßÄ Í≤∞Ï†ï
                  const postCount = currentUser.postCount || 0;
                  let gradeImgSrc = "image/avatar.png"; // Í∏∞Î≥∏
          
                  if (postCount >= 40) {
                    gradeImgSrc = "image/avatar_level4.png";
                  } else if (postCount >= 25) {
                    gradeImgSrc = "image/avatar_level3.png";
                  } else if (postCount >= 10) {
                    gradeImgSrc = "image/avatar_level2.png"; // ÏûàÏúºÎ©¥ ÎÑ£Í≥†, ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ÏúºÎ°ú
                  } else {
                    gradeImgSrc = "image/avatar.png";
                  }
          
                  const gradeImgMobile = document.getElementById("grade-img-mobile");
                  if (gradeImgMobile) gradeImgMobile.src = gradeImgSrc;
          
                  aside.innerHTML = `
                    <div class="account" style="height: 38.69vh;">
                      <div class="account-image"></div>
                      <div class="account-inf">
                          <img src="${gradeImgSrc}" alt="Îì±Í∏â" id="grade-img"/>
                          <span class="account-detail-nickname">${currentUser.nickname}</span>
                      </div>
                      <div class="account-description">
                        <div>
                          <a class="move-inf" href="MyPage (check).html?tab=post">ÎÇ¥Í≤åÏãúÎ¨º</a> | 
                          <a class="move-inf" href="MyPage (check).html?tab=chat">ÎÇ¥ÎåìÍ∏Ä</a> | 
                          <a class="move-inf" href="MyPage (check).html?tab=review">ÎÇ¥Î¶¨Î∑∞</a>
                        </div>
                        <a class="move-inf" href="MyPage (check).html">ÎÇ¥Ï†ïÎ≥¥ ÌôïÏù∏</a>
                      </div>
                    </div>
                    <a class="view-heart" href="MyPage (check).html?tab=wishlist">
                      <img src="image/heart.png" alt="Ï∞úÌïú Í∞ÄÍ≤å" id="heart-img"/>
                      <span id="heart">Ï∞úÌïú Í∞ÄÍ≤å</span>
                    </a>
                  `;
                }
          
                // ÎπÑÌöåÏõê aside UI
                function updateAsideToGuest() {
                const aside = document.querySelector(".aside");
                if (!aside) return;
                aside.innerHTML = `
                  <div class="account" style="height: 45.69vh;">
                    <div style="display:flex; flex-direction:column; align-items: center;">
                      <div class="account-image"></div>
                      <br />
                      <div class="div3">ÎπÑÌöåÏõê Ï†ëÏÜç Ï§ëÏûÖÎãàÎã§.</div>
                    </div>
                    <button type="button" class="button btn btn-dark" onclick="location.href='signup.html'">Î°úÍ∑∏Ïù∏/ÌöåÏõêÍ∞ÄÏûÖ</button>
                  </div>
                `;
          
                ////////////////////(ÏàòÏ†ï:Î™®Î∞îÏùºÏùºÎïå ÎπÑÌöåÏõê Ï†ÅÏö©) Ïù¥Î∂ÄÎ∂ÑÎ∂ÄÌÑ∞~ ///////////////
                const nicknameEls = document.querySelectorAll(".account-detail-nickname");
                nicknameEls.forEach(el => {
                  el.textContent = "ÎπÑÌöåÏõê Ï†ëÏÜç Ï§ëÏûÖÎãàÎã§.";
                });
                const logoutContainer = document.querySelector("#logout-button")?.parentElement;
                if (logoutContainer) {
                  logoutContainer.innerHTML = `
                   
                    <button id="logout-button" class="button" onclick="location.href='signup.html'">
                      <img class="logout-img" src="image/logout.png">
                      <span class="logout-text">Î°úÍ∑∏Ïù∏</span>
                    </button>
                  `;
                }///////////~Ïó¨Í∏∞ÍπåÏßÄ Ï∂îÍ∞Ä//////////////
            }
          
              // ÌöåÏõê UI
              function ReviewUploadToMember(currentUser) {
                const reviewUpload = document.querySelector(".review-upload-button");
                if (!reviewUpload) return;
          
                reviewUpload.innerHTML = `
                  <div class="review-upload-button-text">Î¶¨Î∑∞ ÏóÖÎ°úÎìú</div>
                `;
              }
          
              // ÎπÑÌöåÏõê review-upload-button UI
              function ReviewUploadToGuest() {
              const reviewUpload = document.querySelector(".review-upload-button");
              if (!reviewUpload) return;
              reviewUpload.remove();
              }
          
          
                function renderButtonGroup() {
                const currentUser = JSON.parse(localStorage.getItem("currentUser"));
                const buttonGroup = document.getElementById("buttonGroup");
                if (!buttonGroup) return;
          
                if (currentUser && currentUser.nickname) {
                  buttonGroup.innerHTML = `
                    <button type="button" class="btn btn-light" onclick="location.href='Ïª§ÎÆ§ÎãàÌã∞.html'">Ïª§ÎÆ§ÎãàÌã∞</button>
                    <button type="button" class="btn btn-light" onclick="location.href='Îû≠ÌÇπ.html'">Îû≠ÌÇπ</button>
                    <button type="button" class="btn btn-light" onclick="location.href='MyPage (check).html?tab=wishlist'">Ï∞ú</button>
                    <button type="button" class="btn btn-light" onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
                  `;
                } else {
                  buttonGroup.innerHTML = `
                    <button type="button" class="btn btn-light" onclick="location.href='Ïª§ÎÆ§ÎãàÌã∞.html'">Ïª§ÎÆ§ÎãàÌã∞</button>
                    <button type="button" class="btn btn-light" onclick="location.href='Îû≠ÌÇπ.html'">Îû≠ÌÇπ</button>
                    <button type="button" class="btn btn-light" onclick="location.href='signup.html'">Î°úÍ∑∏Ïù∏/ÌöåÏõêÍ∞ÄÏûÖ</button>
                  `;
                }
              }
          
              // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú UI Ï¥àÍ∏∞Ìôî
              document.addEventListener("DOMContentLoaded", () => {
                const currentUser = JSON.parse(localStorage.getItem("currentUser"));
                if (currentUser && currentUser.nickname) {
                  updateAsideToMember(currentUser);
                  ReviewUploadToMember(currentUser)
                } else {
                  updateAsideToGuest();
                  ReviewUploadToGuest()
                }
                renderButtonGroup(); // Î≤ÑÌäºÎèÑ Î†åÎçîÎßÅ
              });
              </script>
          
          
                    
                    <!-- Ïó¨Í∏∞ÍπåÏßÄ ÏàòÏ†ï ÏôÑÎ£å -->
                    <!-- ‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ† -->
          
                    <!-- Ïó¨Í∏∞Î∂ÄÌÑ∞Îäî Í≥†Ï†ï -->
                    <footer>
                      <div class="text-link-list">
                        <div class="top-area-in-footer">
                          <div class="text-strong">
                            <div class="text-strong2">Web assistant</div>
                          </div>
                        </div>
                        <div class="text-link-list-item">
                          <a class="text-link-list-item" href="Í∞úÎ∞úÏûêÏ†ïÎ≥¥.html">Í∞úÎ∞úÏûêÏ†ïÎ≥¥</a>
                        </div>
                        <div class="text-link-list-item">
                          <div class="list-item2">ÏõπÏÇ¨Ïù¥Ìä∏ Ïù¥Ïö© Î∞©Î≤ï</div>
                        </div>
                        <a class="text-link-list-item" href="ReportPage.html">
                          <div class="list-item2">ÏïÖÏÑ± Ïú†Ï†Ä Ïã†Í≥†</div>
                        </a>
                      </div>
                      <div class="vertical-line"></div>
                      <div class="horizontal-line"></div>
                      <div class="text-link-list">
                        <div class="top-area-in-footer">
                          <div class="text-strong">
                            <div class="text-strong2">Sookmyung University</div>
                          </div>
                        </div>
                        <a class="text-link-list-item" href="https://www.sookmyung.ac.kr/kr/index.do">ÏàôÎ™ÖÏó¨ÏûêÎåÄÌïôÍµê ÌôàÌéòÏù¥ÏßÄ</a>
                        <a class="text-link-list-item" href="https://snowboard.sookmyung.ac.kr/login/index.php">Ïä§ÎÖ∏Ïö∞Î≥¥Îìú</a>
                        <a class="text-link-list-item" href="https://portal.sookmyung.ac.kr/irj/portal">ÏàôÎ™ÖÌè¨ÌÑ∏</a>
                      </div>
                    </footer>
                  </div>
                </div>
              </div>
          
              
              
          
              
          
              <script>
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (currentUser && currentUser.nickname) {
                document.querySelector('.account-detail-nickname').innerHTML = currentUser.nickname;
                }
              </script>
          
              <script>//Ìï¥Îãπ ÏãùÎãπÏùò Ï†ïÎ≥¥ Î≥¥Ïó¨Ï£ºÍ∏∞
      
    function renderStars(rating) {
    const fullStar = 'https://c.animaapp.com/kjYfscdy/img/star-63.svg';
    const halfStar = 'https://c.animaapp.com/kjYfscdy/img/star-61.svg'; // Î∞òÎ≥Ñ ÏïÑÏù¥ÏΩò ÏòàÏãú (ÏóÜÏúºÎ©¥ Í∑∏ÎÉ• fullStar ÎåÄÏ≤¥ Í∞ÄÎä•)
    const emptyStar = 'https://c.animaapp.com/kjYfscdy/img/star-59.svg';

    const starsContainer = document.querySelector('.rating2');
    starsContainer.innerHTML = ''; // Í∏∞Ï°¥ Î≥Ñ Ï†úÍ±∞

    const fullCount = Math.floor(rating);
    const hasHalf = rating - fullCount >= 0.5;
    const emptyCount = 5 - fullCount - (hasHalf ? 1 : 0);

    for (let i = 0; i < fullCount; i++) {
      const img = document.createElement('img');
      img.className = 'star';
      img.src = fullStar;
      starsContainer.appendChild(img);
    }
    if (hasHalf) {
      const img = document.createElement('img');
      img.className = 'star';
      img.src = halfStar;
      starsContainer.appendChild(img);
    }
    for (let i = 0; i < emptyCount; i++) {
      const img = document.createElement('img');
      img.className = 'star';
      img.src = emptyStar;
      starsContainer.appendChild(img);
    }
  }
</script>

<script>
// Ï∞ú Î™©Î°ù Î∂àÎü¨Ïò§Í∏∞
function getfavorite() {
  const fav = localStorage.getItem('favorite');
  return fav ? JSON.parse(fav) : [];
}

// Ï∞ú Î™©Î°ù Ï†ÄÏû•
function savefavorite(favorite) {
  localStorage.setItem('favorite', JSON.stringify(favorite));
}

// Ï∞ú Ïó¨Î∂Ä ÌôïÏù∏ Ìï®Ïàò
function isFavorited(storeId, userId) {
  const favorite = getfavorite();
  return favorite.some(fav => fav.id === storeId && fav.userId === userId);
}

// ÌïòÌä∏ ÏïÑÏù¥ÏΩò ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
function updateHeartIcon(isFav) {
  const heartImg = document.getElementById('personal-heart-img');
  if (!heartImg) return;
  if (isFav) {
    heartImg.innerHTML = "‚ù§Ô∏è";
  } else {
    heartImg.innerHTML = "ü§ç";
  }
}

// Ï∞ú Ï∂îÍ∞Ä/Ï†úÍ±∞ Ìï®Ïàò
function toggleFavorite(store, userId) {
  const favorite = getfavorite();

  const existsIndex = favorite.findIndex(
    fav => fav.id === store.id && fav.userId === userId
  );

  let isFav;

  if (existsIndex === -1) {
    favorite.push({ ...store, userId }); // Ï∞ú Ï∂îÍ∞Ä
    savefavorite(favorite);
    alert('Ï∞úÌïú Í∞ÄÍ≤åÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.');
    isFav = true;
  } else {
    favorite.splice(existsIndex, 1); // Ï∞ú Ï†úÍ±∞
    savefavorite(favorite);
    alert('Ï∞úÏù¥ Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.');
    isFav = false;
  }

  updateHeartIcon(isFav); // Ïù¥ÎØ∏ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
}

// Ï∞ú Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù
document.querySelector('.heart-button').addEventListener('click', () => {
  const currentUser = JSON.parse(localStorage.getItem('currentUser'));
  if (!currentUser) {
    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
    return;
  }

  const urlParams = new URLSearchParams(window.location.search);
  const storeId = urlParams.get('id');

  fetch('stores.json')
    .then(res => res.json())
    .then(data => {
      const store = data.find(s => s.id === storeId);
      if (!store) {
        alert('Ìï¥Îãπ Í∞ÄÍ≤å Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
        return;
      }

      toggleFavorite(store, currentUser.id);
    })
    .catch(err => {
      console.error('ÏãùÎãπ Ï†ïÎ≥¥ Î°úÎî© Ïã§Ìå®:', err);
      alert('Ï∞ú Ï≤òÎ¶¨ Ï§ë Ïò§Î•ò Î∞úÏÉù');
    });
});

// ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï∞ú ÏÉÅÌÉú Î∞òÏòÅ
window.addEventListener('DOMContentLoaded', () => {
  const currentUser = JSON.parse(localStorage.getItem('currentUser'));
  const urlParams = new URLSearchParams(window.location.search);
  const storeId = urlParams.get('id');

  if (currentUser && storeId) {
    const isFav = isFavorited(storeId, currentUser.id);
    updateHeartIcon(isFav); // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ï∞ú Ïù¥ÎØ∏ÏßÄ Ï¥àÍ∏∞Ìôî
  }
});

    </script>



<script>//Ìï¥Îãπ ÏãùÎãπÏùò Ï†ïÎ≥¥ Î≥¥Ïó¨Ï£ºÍ∏∞
      
  function renderStars(rating) {
  const fullStar = 'https://c.animaapp.com/kjYfscdy/img/star-63.svg';
  const halfStar = 'https://c.animaapp.com/kjYfscdy/img/star-61.svg'; // Î∞òÎ≥Ñ ÏïÑÏù¥ÏΩò ÏòàÏãú (ÏóÜÏúºÎ©¥ Í∑∏ÎÉ• fullStar ÎåÄÏ≤¥ Í∞ÄÎä•)
  const emptyStar = 'https://c.animaapp.com/kjYfscdy/img/star-59.svg';

  const starsContainer = document.querySelector('.rating2');
  starsContainer.innerHTML = ''; // Í∏∞Ï°¥ Î≥Ñ Ï†úÍ±∞

  const fullCount = Math.floor(rating);
  const hasHalf = rating - fullCount >= 0.5;
  const emptyCount = 5 - fullCount - (hasHalf ? 1 : 0);

  for (let i = 0; i < fullCount; i++) {
    const img = document.createElement('img');
    img.className = 'star';
    img.src = fullStar;
    starsContainer.appendChild(img);
  }
  if (hasHalf) {
    const img = document.createElement('img');
    img.className = 'star';
    img.src = halfStar;
    starsContainer.appendChild(img);
  }
  for (let i = 0; i < emptyCount; i++) {
    const img = document.createElement('img');
    img.className = 'star';
    img.src = emptyStar;
    starsContainer.appendChild(img);
  }
}
</script>

<script>
// Ï∞ú Î™©Î°ù Î∂àÎü¨Ïò§Í∏∞
function getfavorite() {
const fav = localStorage.getItem('favorite');
return fav ? JSON.parse(fav) : [];
}

// Ï∞ú Î™©Î°ù Ï†ÄÏû•
function savefavorite(favorite) {
localStorage.setItem('favorite', JSON.stringify(favorite));
}

// Ï∞ú Ïó¨Î∂Ä ÌôïÏù∏ Ìï®Ïàò
function isFavorited(storeId, userId) {
const favorite = getfavorite();
return favorite.some(fav => fav.id === storeId && fav.userId === userId);
}

// ÌïòÌä∏ ÏïÑÏù¥ÏΩò ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
function updateHeartIcon(isFav) {
const heartImg = document.getElementById('personal-heart-img');
if (!heartImg) return;
if (isFav) {
  heartImg.innerHTML = "‚ù§Ô∏è";
} else {
  heartImg.innerHTML = "ü§ç";
}
}

// Ï∞ú Ï∂îÍ∞Ä/Ï†úÍ±∞ Ìï®Ïàò
function toggleFavorite(store, userId) {
const favorite = getfavorite();

const existsIndex = favorite.findIndex(
  fav => fav.id === store.id && fav.userId === userId
);

let isFav;

if (existsIndex === -1) {
  favorite.push({ ...store, userId }); // Ï∞ú Ï∂îÍ∞Ä
  savefavorite(favorite);
  alert('Ï∞úÌïú Í∞ÄÍ≤åÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.');
  isFav = true;
} else {
  favorite.splice(existsIndex, 1); // Ï∞ú Ï†úÍ±∞
  savefavorite(favorite);
  alert('Ï∞úÏù¥ Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.');
  isFav = false;
}

updateHeartIcon(isFav); // Ïù¥ÎØ∏ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
}

// Ï∞ú Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù
document.querySelector('.heart-button').addEventListener('click', () => {
const currentUser = JSON.parse(localStorage.getItem('currentUser'));
if (!currentUser) {
  alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
  return;
}

const urlParams = new URLSearchParams(window.location.search);
const storeId = urlParams.get('id');

fetch('stores.json')
  .then(res => res.json())
  .then(data => {
    const store = data.find(s => s.id === storeId);
    if (!store) {
      alert('Ìï¥Îãπ Í∞ÄÍ≤å Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
      return;
    }

    toggleFavorite(store, currentUser.id);
  })
  .catch(err => {
    console.error('ÏãùÎãπ Ï†ïÎ≥¥ Î°úÎî© Ïã§Ìå®:', err);
    alert('Ï∞ú Ï≤òÎ¶¨ Ï§ë Ïò§Î•ò Î∞úÏÉù');
  });
});

// ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï∞ú ÏÉÅÌÉú Î∞òÏòÅ
window.addEventListener('DOMContentLoaded', () => {
const currentUser = JSON.parse(localStorage.getItem('currentUser'));
const urlParams = new URLSearchParams(window.location.search);
const storeId = urlParams.get('id');

if (currentUser && storeId) {
  const isFav = isFavorited(storeId, currentUser.id);
  updateHeartIcon(isFav); // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ï∞ú Ïù¥ÎØ∏ÏßÄ Ï¥àÍ∏∞Ìôî
}
});

  </script>



<script>
const DB_NAME = 'MyStoreDB';
const STORE_NAME = 'stores';
const DB_VERSION = 2;

// IndexedDB Ïó¥Í∏∞ (DBÏôÄ objectStore Ï§ÄÎπÑ)
function openDB() {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(DB_NAME, DB_VERSION);

    request.onupgradeneeded = (event) => {
      const db = event.target.result;
      if (!db.objectStoreNames.contains(STORE_NAME)) {
        db.createObjectStore(STORE_NAME, { keyPath: 'id' });
      }
    };

    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });
}

// stores.jsonÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏ÏôÄ IndexedDBÏóê Ï†ÄÏû• (Ï¥àÍ∏∞ÌôîÏö©)
async function initStoresInDB() {
  const db = await openDB();

  return new Promise(async (resolve, reject) => {
    const tx = db.transaction(STORE_NAME, 'readonly');
    const store = tx.objectStore(STORE_NAME);

    // Î®ºÏ†Ä Îç∞Ïù¥ÌÑ∞Í∞Ä Ïù¥ÎØ∏ ÏûàÎäîÏßÄ ÌôïÏù∏ (Ï§ëÎ≥µ Ï†ÄÏû• Î∞©ÏßÄ)
    const countRequest = store.count();
    countRequest.onsuccess = async () => {
      if (countRequest.result > 0) {
        // Ïù¥ÎØ∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎãà Ï¥àÍ∏∞ÌôîÌïòÏßÄ ÏïäÏùå
        resolve();
      } else {
        try {
          const response = await fetch('stores.json');
          const stores = await response.json();

          const txWrite = db.transaction(STORE_NAME, 'readwrite');
          const storeWrite = txWrite.objectStore(STORE_NAME);

          for (const s of stores) {
            storeWrite.put(s);
          }

          txWrite.oncomplete = () => resolve();
          txWrite.onerror = () => reject(txWrite.error);
        } catch (err) {
          reject(err);
        }
      }
    };
    countRequest.onerror = () => reject(countRequest.error);
  });
}

// IndexedDBÏóêÏÑú ÌäπÏ†ï ÏÉÅÏ†ê Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
async function getStore(storeId) {
  const db = await openDB();

  return new Promise((resolve, reject) => {
    const tx = db.transaction(STORE_NAME, 'readonly');
    const store = tx.objectStore(STORE_NAME);

    const request = store.get(storeId);
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });
}

// IndexedDBÏóêÏÑú ÌäπÏ†ï ÏÉÅÏ†ê Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
async function updateStore(store) {
const db = await openDB();

return new Promise((resolve, reject) => {
  const tx = db.transaction(STORE_NAME, 'readwrite');
  const storeObj = tx.objectStore(STORE_NAME);

  const request = storeObj.put(store);
  request.onerror = () => reject(request.error);

  tx.oncomplete = () => resolve();
  tx.onerror = () => reject(tx.error);
});
}

// localStorageÏóêÏÑú Îã®Í≥® Í∞ÄÍ≤å Î∞∞Ïó¥ Î∂àÎü¨Ïò§Í∏∞
function getBookmarks() {
  const bookmarks = localStorage.getItem('bookmarks');
  return bookmarks ? JSON.parse(bookmarks) : [];
}

// localStorageÏóê Îã®Í≥® Í∞ÄÍ≤å Î∞∞Ïó¥ Ï†ÄÏû•ÌïòÍ∏∞
function saveBookmarks(bookmarks) {
  localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
}

// Îã®Í≥® Ïó¨Î∂Ä ÌôïÏù∏ Ìï®Ïàò
function isBookmarked(storeId) {
  const bookmarks = getBookmarks();
  return bookmarks.includes(storeId);
}

// Î∂ÅÎßàÌÅ¨ ÏïÑÏù¥ÏΩò ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò (Ï±ÑÏö¥/ÌÖåÎëêÎ¶¨)
function updateBookmarkIcon(isBookmarked) {
  const img = document.getElementById('bookmark-img');
  if (!img) return;

  img.src = isBookmarked ? 'image/full-bookmark.png' : 'image/empty-bookmark.png';
}

// IndexedDBÏóêÏÑú Îã®Í≥® Ïàò +1 Ìï¥Ï£ºÎäî Ìï®Ïàò
async function incrementBookmarkCount(storeId) {
  const store = await getStore(storeId);
  if (!store) throw new Error('Í∞ÄÍ≤å Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');

  store.bookmark = (store.bookmark || 0) + 1;
  await updateStore(store);
}

// IndexedDBÏóêÏÑú Îã®Í≥® Ïàò -1 Ìï¥Ï£ºÎäî Ìï®Ïàò
async function decrementBookmarkCount(storeId) {
  const store = await getStore(storeId);
  if (!store) throw new Error('Í∞ÄÍ≤å Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');

  store.bookmark = Math.max((store.bookmark || 1) - 1, 0);
  await updateStore(store);
}

// ÌÅ¥Î¶≠ Ïãú Îã®Í≥® Í∞ÄÍ≤å Ï∂îÍ∞Ä/Ï†úÍ±∞ ÌÜ†Í∏Ä Ìï®Ïàò (async)
async function toggleBookmark(storeId) {
  let bookmarks = getBookmarks();

  if (bookmarks.includes(storeId)) {
    bookmarks = bookmarks.filter(id => id !== storeId);
    saveBookmarks(bookmarks);
    alert('Îã®Í≥® Í∞ÄÍ≤åÏóêÏÑú Ï†úÍ±∞ÎêòÏóàÏäµÎãàÎã§.');
    updateBookmarkIcon(false);

    try {
      await decrementBookmarkCount(storeId);
      console.log('IndexedDB Îã®Í≥® Ïàò -1 ÏôÑÎ£å');
    } catch (err) {
      console.error(err);
    }
  } else {
    bookmarks.push(storeId);
    saveBookmarks(bookmarks);
    alert('Îã®Í≥® Í∞ÄÍ≤åÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.');
    updateBookmarkIcon(true);

    try {
      await incrementBookmarkCount(storeId);
      console.log('IndexedDB Îã®Í≥® Ïàò +1 ÏôÑÎ£å');
    } catch (err) {
      console.error(err);
    }
  }
}

// ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌòÑÏû¨ Îã®Í≥® Ïó¨Î∂ÄÏóê Îî∞Îùº ÏïÑÏù¥ÏΩò Ï¥àÍ∏∞Ìôî
async function initBookmark(storeId) {
  updateBookmarkIcon(isBookmarked(storeId));
}

(async () => {
  try {
    // IndexedDB Ï¥àÍ∏∞Ìôî (Ï§ëÎ≥µ Ï†ÄÏû• Î∞©ÏßÄ)
    await initStoresInDB();

    // Ïã§Ï†ú storeId
    const params = new URLSearchParams(window.location.search);
    const storeId = params.get('id');

    if (!storeId) {
      console.error('URLÏóê storeIdÍ∞Ä ÏóÜÏäµÎãàÎã§.');
      return;
    }

    // Î∂ÅÎßàÌÅ¨ ÏïÑÏù¥ÏΩò ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
    await initBookmark(storeId);

    // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Îì±Î°ù (id='bookmark' Î≤ÑÌäº ÎòêÎäî imgÏóê)
    const bookmarkElem = document.getElementById('bookmark');
    if (bookmarkElem) {
      bookmarkElem.addEventListener('click', async () => {
        await toggleBookmark(storeId);
      });
    } else {
      console.warn('id="bookmark" ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
    }
  } catch (e) {
    console.error('Ï¥àÍ∏∞Ìôî Ï§ë Ïò§Î•ò:', e);
  }
})();
</script>




    <script>
      let store_aside2=[];
        function renderAside(sortedArray) {
          const top7 = sortedArray.slice(0, 7);
          renderAsideStores(top7);
        }
        function handleSortAside(criteria) {
          const sorted = getSortedStores(criteria);
          renderAside(sorted);
        }

         //sort Ìï®Ïàò(aside2/mainbody Í≥µÌÜµ)
        function getSortedStores(criteria = "rating") {
        return [...store_aside2].sort((a, b) => {
          if (b[criteria] !== a[criteria]) return b[criteria] - a[criteria];

          if (criteria === "rating")    return b.reviews - a.reviews || b.bookmark - a.bookmark;
          if (criteria === "reviews")   return b.rating  - a.rating  || b.bookmark - a.bookmark;
          if (criteria === "bookmark") return b.rating  - a.rating  || b.reviews  - a.reviews;
          return 0;
        });
      }

      //asideÎ†åÎçîÎßÅ
        function renderAsideStores(sortedArray) {
        const top7 = sortedArray.slice(0, 7);
        const asideEl = document.getElementById("store-sort");

        asideEl.innerHTML = `
        <ul class="store-list">
          ${top7.map((store, index) => `
            <li class="store-item">
              <div class="store-rank-name">
                <div class="rank-circle">${index + 1}</div>
                <span class="store-name-aside">${store.name}</span>
              </div>
              <span class="store-rating">
                <img src="https://c.animaapp.com/kjYfscdy/img/star-60.svg" style="width:20px; height:100%; margin-bottom:3px;" />
                ${store.rating.toFixed(1)}
              </span>
            </li>
          `).join('')}
        </ul>
      `;
    }
    

    window.addEventListener('DOMContentLoaded', () => {/////////////(2) onloadÎπºÍ≥† Ïù¥Í±∞
    fetch('stores.json')       
      .then(res => res.json())
      .then(data => {
        store_aside2= data;
        const sorted = getSortedStores("rating");
        renderAsideStores(sorted);
      })
      .catch(err => console.error('JSON Î°úÎî© Ïã§Ìå®:', err));
  });/////////////aside2ÏàòÏ†ïÏôÑÎ£å///////////////
    </script>




    <!-- sl-tab Î∞îÎ°úÍ∞ÄÍ∏∞ÏôÄ Í¥ÄÎ†®Ìïú ÏûêÎ∞î Ïä§ÌÅ¨Î¶ΩÌä∏ Ï∂îÍ∞Ä -->
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const tabToShow = urlParams.get("tab");

        if (tabToShow) {
          const tabGroup = document.querySelector("sl-tab-group");
          if (tabGroup) {
            tabGroup.show(tabToShow); // Ìï¥Îãπ panel IDÎ•º Î≥¥Ïó¨Ï§å
          }
        }
      });
    console.log(document.querySelector('.store-name'));

    </script>

    <script>
  // Í≥µÌÜµ Í≤ÄÏÉâ Ìï®Ïàò
  function handleSearch() {
    const keywordInput = document.getElementById("search-form");
    const keyword = encodeURIComponent(keywordInput.value.trim());

    if (keyword) {
      location.href = `SearchPage.html?keyword=${keyword}`;
    } else {
      alert("Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");
    }
  }

  // Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú
  document.getElementById("search-btn").addEventListener("click", handleSearch);

  // Ïù¥ÎØ∏ÏßÄ ÌÅ¥Î¶≠ Ïãú (ÏûëÏùÄ ÌôîÎ©¥ÏóêÏÑúÎßå)
  document.getElementById("search-img").addEventListener("click", () => {
    if (window.innerWidth <= 1024.98) {
      handleSearch();
    }
  });

  // Enter ÌÇ§Î°úÎèÑ Í≤ÄÏÉâÎêòÍ≤å
  document.getElementById("search-form").addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      handleSearch();
    }
  });
</script>

    <script>
  // DOMÏù¥ ÏôÑÏ†ÑÌûà Î°úÎìúÎêú ÌõÑ Ïã§Ìñâ
  document.addEventListener('DOMContentLoaded', function () {
    const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
    popoverTriggerList.forEach(function (popoverTriggerEl) {
      new bootstrap.Popover(popoverTriggerEl, {
        placement: 'right',
        offset: [10, 15],
        content: '<h6>ÎÇòÎßåÏùò ÏãùÎãπÏùÑ Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî!</h6><p>Ï∞úÏúºÎ°ú ÎÇòÎßåÏùò ÏãùÎãπÏùÑ Ï∞æÍ≥†, <br />Îã®Í≥®Î°ú ÎÇòÎßåÏùò ÏãùÎãπÏùÑ Í≥µÏú†ÌïòÏÑ∏Ïöî!</p>',
        html: true,
        trigger: 'hover' })
    })
  });
</script>

    <!-- ÏûÖÎ†•Ï∞ΩÏóê ÌäπÏ†ï Î¨∏Íµ¨ ÏûÖÎ†•ÌñàÏùÑ Îïå ÎÇòÏò§Îäî Îπ®Í∞Ñ Î∞ëÏ§Ñ Ï†úÍ±∞ -->
    <script>
    document.addEventListener("DOMContentLoaded", () => {
      const inputs = document.querySelectorAll('input, textarea, [contenteditable]');

      inputs.forEach(el => {
        el.setAttribute('spellcheck', 'false');
        el.setAttribute('autocomplete', 'off');
        el.setAttribute('autocorrect', 'off');       // iOS Safari Îì±ÏóêÏÑú Ïú†Ïö©
        el.setAttribute('autocapitalize', 'off');    // Ï≤´ Í∏ÄÏûê ÏûêÎèô ÎåÄÎ¨∏Ïûê Î∞©ÏßÄ
      });
  });
    </script>

<script>
  document.querySelector('.bookmark-button').addEventListener('click', () => {
  console.log("Î∂ÅÎßàÌÅ¨Î≤ÑÌäºÌÅ¥Î¶≠Îê®")
  const currentUser = JSON.parse(localStorage.getItem('currentUser'));
  
  if (!currentUser) {
    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
    return;
  }
});
</script>
     
  </body>
</html>